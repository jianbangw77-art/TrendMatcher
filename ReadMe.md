# TrendMatcher: åŸºäºè§†è§‰çš„è¶‹åŠ¿ç›¸ä¼¼åº¦åˆ†æç³»ç»Ÿ

**TrendMatcher** æ˜¯ä¸€ä¸ªå·¥ç¨‹åŒ–çš„è®¡ç®—æœºè§†è§‰ä¸ä¿¡å·å¤„ç†å·¥å…·ï¼Œæ—¨åœ¨é‡åŒ–åˆ†æé‡‘èå›¾è¡¨ï¼ˆå¦‚ K çº¿ã€MACDã€é‡èƒ½æŸ±ï¼‰ä¹‹é—´çš„è¶‹åŠ¿ç›¸ä¼¼åº¦ã€‚

è¯¥ç³»ç»Ÿé€šè¿‡è®¡ç®—æœºè§†è§‰æŠ€æœ¯ä»é™æ€æˆªå›¾ä¸­æå–çº¢/ç»¿/æ©™æŸ±çŠ¶ä¿¡å·ï¼Œè½¬åŒ–ä¸ºæ—¶é—´åºåˆ—æ•°æ®ï¼Œå¹¶åˆ©ç”¨**åŠ æƒä½™å¼¦ç›¸ä¼¼åº¦ç®—æ³•**ï¼ˆWeighted Cosine Similarityï¼‰è®¡ç®—ä¸»å›¾ä¸å¹…å›¾çš„åŒ¹é…å¾—åˆ†ã€‚ç®—æ³•ç‰¹åˆ«è®¾è®¡äº†**æ—¶é—´è¡°å‡é€»è¾‘**ï¼Œå³è¿‘æœŸæ•°æ®ï¼ˆå³ä¾§ï¼‰çš„æƒé‡é«˜äºè¿œæœŸæ•°æ®ï¼ˆå·¦ä¾§ï¼‰ï¼Œç¬¦åˆè¶‹åŠ¿åˆ†æçš„ç›´è§‰ã€‚

## ğŸŒŸ æ ¸å¿ƒç‰¹æ€§ (Features)

- **è§†è§‰ä¿¡å·æå– (Visual Signal Extraction)**: åŸºäº HSV é¢œè‰²ç©ºé—´è‡ªåŠ¨åˆ†ç¦»æ­£å‘ï¼ˆå¦‚ç»¿è‰²/çº¢è‰²æ¶¨å¹…ï¼‰ä¸è´Ÿå‘ï¼ˆå¦‚æ©™è‰²/è“è‰²è·Œå¹…ï¼‰ä¿¡å·ï¼Œé€šè¿‡åƒç´ ç§¯åˆ†è½¬åŒ–ä¸ºæ•°å€¼åºåˆ—ã€‚
- **æŠ—å™ªä¸å½’ä¸€åŒ– (Robust Preprocessing)**: å†…ç½®é«˜æ–¯å¹³æ»‘ (Gaussian Smoothing) ä¸ Z-Score æ ‡å‡†åŒ–ï¼Œæ¶ˆé™¤å›¾åƒåˆ†è¾¨ç‡å·®å¼‚ã€å™ªç‚¹åŠç»å¯¹å¹…åº¦çš„å½±å“ã€‚
- **åŠ æƒè¶‹åŠ¿åŒ¹é… (Weighted Similarity)**: å®ç°äº†â€œæ—¶é—´åŠ æƒâ€é€»è¾‘ï¼Œå³ä¾§ï¼ˆè¿‘æœŸï¼‰æ•°æ®çš„ç›¸ä¼¼åº¦æƒé‡é«˜äºå·¦ä¾§ï¼ˆè¿œæœŸï¼‰ã€‚
- **å®Œå…¨å·¥ç¨‹åŒ– (Engineering Ready)**:
  - **ä¸­æ–‡æ”¯æŒ**: å®Œç¾è§£å†³ Windows ä¸‹ OpenCV è¯»å–ä¸­æ–‡è·¯å¾„åŠ Matplotlib ä¸­æ–‡ä¹±ç é—®é¢˜ã€‚
  - **æ‰¹å¤„ç†**: æ”¯æŒè‡ªåŠ¨æ‰«æ `dataset` ç›®å½•ä¸‹çš„å¤šä¸ªæ¡ˆä¾‹æ–‡ä»¶å¤¹ã€‚
  - **å¯è§†åŒ–æŠ¥å‘Š**: è‡ªåŠ¨ç”Ÿæˆå¸¦æœ‰å¯¹æ¯”æ›²çº¿å’Œåˆ¤å®šç»“æœçš„åˆ†æå›¾è¡¨ã€‚

## ğŸ“ ç›®å½•ç»“æ„ (Directory Structure)

```
TrendMatcher/
â”‚
â”œâ”€â”€ dataset/                # [æ•°æ®æº] å­˜æ”¾å¾…åˆ†æçš„æ¡ˆä¾‹æ–‡ä»¶å¤¹
â”‚   â”œâ”€â”€ case_01/            # æ¡ˆä¾‹æ–‡ä»¶å¤¹ (åç§°éœ€å”¯ä¸€)
â”‚   â”‚   â”œâ”€â”€ main.png        # ä¸»å›¾ (æ–‡ä»¶åéœ€åŒ…å« 'main' æˆ– 'ä¸»')
â”‚   â”‚   â”œâ”€â”€ sub_1.png       # å¹…å›¾ (æ–‡ä»¶åä»»æ„)
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ outputs/                # [ç»“æœ] ç¨‹åºè¿è¡Œç»“æœ
â”‚   â””â”€â”€ run_20251223_.../   # æŒ‰æ—¶é—´æˆ³éš”ç¦»çš„å®éªŒæŠ¥å‘Šå›¾ç‰‡
â”‚
â”œâ”€â”€ core/                   # [æ ¸å¿ƒæ¨¡å—]
â”‚   â”œâ”€â”€ loader.py           # æ•°æ®åŠ è½½å™¨ (è‡ªåŠ¨æ‰«æ dataset)
â”‚   â”œâ”€â”€ vision.py           # è§†è§‰å±‚ (HSV æå–, æ”¯æŒä¸­æ–‡è·¯å¾„)
â”‚   â”œâ”€â”€ signal.py           # ä¿¡å·å±‚ (å¹³æ»‘, å½’ä¸€åŒ–)
â”‚   â””â”€â”€ metrics.py          # ç®—æ³•å±‚ (åŠ æƒä½™å¼¦ç›¸ä¼¼åº¦)
â”‚
â”œâ”€â”€ utils/                  # [å·¥å…·æ¨¡å—]
â”‚   â””â”€â”€ config.py           # å…¨å±€é…ç½®æ–‡ä»¶ (HSVé˜ˆå€¼, æƒé‡å‚æ•°)
â”‚
â”œâ”€â”€ main.py                 # ç¨‹åºå¯åŠ¨å…¥å£
â””â”€â”€ requirements.txt        # ä¾èµ–åº“åˆ—è¡¨
```

## ğŸš€ å¿«é€Ÿå¼€å§‹ (Quick Start)

### 1. ç¯å¢ƒå‡†å¤‡

ç¡®ä¿å®‰è£… Python 3.9+ï¼Œå¹¶å®‰è£…æ ¸å¿ƒä¾èµ–ï¼š

```
pip install numpy opencv-python matplotlib scipy
```

### 2. å‡†å¤‡æ•°æ®

åœ¨ `dataset/` ç›®å½•ä¸‹åˆ›å»ºæ¡ˆä¾‹æ–‡ä»¶å¤¹ï¼ˆå¦‚ `case_01`ï¼‰ï¼Œå¹¶æ”¾å…¥æˆªå›¾ï¼š

- **ä¸»å›¾å‘½å**: æ–‡ä»¶åå¿…é¡»åŒ…å« `main` æˆ– `ä¸»`ï¼ˆä¾‹å¦‚ `main.png`, `ä¸»å›¾.jpg`ï¼‰ã€‚
- **å¹…å›¾å‘½å**: é™¤ä¸»å›¾å¤–çš„å›¾ç‰‡å‡è¢«è§†ä¸ºå¹…å›¾ï¼ˆä¾‹å¦‚ `sub_01.png`ï¼‰ã€‚

### 3. è¿è¡Œç¨‹åº

åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹è¿è¡Œï¼š

```
python main.py
```

ç¨‹åºå°†è‡ªåŠ¨æ‰«ææ‰€æœ‰æ¡ˆä¾‹ï¼Œåœ¨ç»ˆç«¯è¾“å‡ºç›¸ä¼¼åº¦å¾—åˆ†ï¼Œå¹¶åœ¨ `outputs/` ç›®å½•ä¸‹ç”Ÿæˆå¯¹æ¯”å›¾ã€‚

## âš™ï¸ å‚æ•°é…ç½® (Configuration)

æ‰€æœ‰ç®—æ³•ä¸è§†è§‰å‚æ•°å‡ä½äº `utils/config.py`ï¼Œéœ€æ ¹æ®å®é™…å›¾ç‰‡é¢œè‰²è¿›è¡Œå¾®è°ƒã€‚

### é¢œè‰²æå– (HSV Thresholds)

é’ˆå¯¹ä¸åŒçš„å›¾è¡¨é…è‰²ï¼ˆå¦‚â€œçº¢æ¶¨ç»¿è·Œâ€æˆ–â€œç»¿æ¶¨æ©™è·Œâ€ï¼‰ï¼Œéœ€è°ƒæ•´ HSV èŒƒå›´ã€‚

**é…ç½®ç¤ºä¾‹ï¼ˆé’ˆå¯¹ç»¿æ¶¨æ©™è·Œï¼‰ï¼š**

```
# utils/config.py

# ã€æ­£å‘ä¿¡å·ã€‘ï¼šç»¿è‰² (Green)
POS_LOWER = (35, 43, 46)   # ç»¿è‰²ä¸‹ç•Œ
POS_UPPER = (90, 255, 255) # ç»¿è‰²ä¸Šç•Œ

# ã€è´Ÿå‘ä¿¡å·ã€‘ï¼šæ©™è‰²/çº¢è‰² (Orange/Red)
NEG_LOWER1 = (0, 43, 46)   # æ©™è‰²/çº¢è‰²ä¸‹ç•Œ
NEG_UPPER1 = (25, 255, 255)# æ©™è‰²/çº¢è‰²ä¸Šç•Œ
```

### ç®—æ³•å‚æ•°

- **`SAMPLING_POINTS`**: æå–åºåˆ—çš„é•¿åº¦ï¼ˆé»˜è®¤ 100ï¼‰ã€‚
- **`SIGMA_SMOOTH`**: é«˜æ–¯å¹³æ»‘ç³»æ•°ã€‚æ•°å€¼è¶Šå¤§æ›²çº¿è¶Šåœ†æ»‘ï¼ˆé»˜è®¤ 2.0ï¼‰ï¼Œç”¨äºæŠµæŠ—å™ªç‚¹ã€‚
- **åˆ¤å®šé˜ˆå€¼**: åœ¨ `main.py` ä¸­ä¿®æ”¹ `score > 0.8` æ¥è°ƒæ•´åˆæ ¼æ ‡å‡†ã€‚

## ğŸ“Š ç®—æ³•åŸç† (Algorithm)

1. **å›¾åƒè§£ç **: ä½¿ç”¨ `np.fromfile` + `cv2.imdecode` è¯»å–å›¾åƒæµï¼Œç»•è¿‡ OpenCV çš„è·¯å¾„ç¼–ç é™åˆ¶ã€‚

2. **ä¿¡å·åˆ†ç¦»**:

   - $$
     Mask_{pos}=HSV\in\left[POS_Range\right]
     $$

   - $$
     Mask_{neg} = HSV \in [NEG\_Range]
     $$

     

3. åºåˆ—ç§¯åˆ†:

   å¯¹å›¾åƒæ²¿ X è½´åˆ‡ç‰‡ï¼Œè®¡ç®—æ¯ä¸€åˆ—çš„å‡€èƒ½é‡ï¼š

   
   $$
   S[t] = \text{Count}(Mask_{pos}[t]) - \text{Count}(Mask_{neg}[t])
   $$
   

4. åŠ æƒç›¸ä¼¼åº¦:

   ä½¿ç”¨åŠ æƒä½™å¼¦ç›¸ä¼¼åº¦è®¡ç®—ä¸»å›¾åºåˆ— $A$ ä¸å¹…å›¾åºåˆ— $B$ çš„ç›¸å…³æ€§ï¼Œå…¶ä¸­æƒé‡ $w$ éšæ—¶é—´çº¿æ€§å¢åŠ ï¼ˆå³ä¾§æƒé‡é«˜ï¼‰ï¼š

   
   $$
   Similarity = \frac{\sum w_i \cdot A_i \cdot B_i}{\sqrt{\sum w_i A_i^2} \cdot \sqrt{\sum w_i B_i^2}}
   $$
   

